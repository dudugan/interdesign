<!DOCTYPE html>
<html>
<head>
    <title>Uploader</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/15.1.3/Tone.js"></script>
</head>
<style>
    body {height: 100vh; width: 100vw; text-align: center;}
    #outputText {
        margin-top: 20px;
        font-size: 25px;
        line-height: 1.6;
        color: blueviolet; 
    }
</style>
<body>
    <h1>Upload a dna file pls</h1>
    <input type="file" id="fileInput">
    <button onclick="processFile()">Upload</button>
    <div id="outputText"></div>
    <button onclick="playsound()">Play Sound</button>
</body>
<script>
    let ready = false; 

    // create polysynth
    let poly; 

    function initializeAudio(){
        poly = new Tone.PolySynth(Tone.AMSynth, 
            {
                envelope: {
                    attack: 4, 
                    release: 4, 
                }
            }
        ); 
        poly.toDestination(); 
    }

    function playsound(){
        if (!ready){
            initializeAudio();
            ready = true;
        }
        poly.triggerAttackRelease(["C4", "Eb4", "G4"], '1m'); 
    }





    var synth = new Tone.PolySynth().toDestination(); 

    function play(nucleotide){
        if (nucleotide == 'T'){
            nucleotide = 'E'; 
        }
        nucleotide += '4'
        synth.triggerAttackRelease(nucleotide, '16n')
    }

    async function processFile(){
        const fileInput = document.getElementById('fileInput');
        const outputText = document.getElementById('outputText');

        if (fileInput.files.length === 0){
            alert('Please select a file');
            return; 
        }
        
        const file = fileInput.files[0]
        const reader = new FileReader();

        reader.onload = async function(event){
            const fileContent = event.target.result;
            let output = '';

            // iteration!
            for (let i = 0; i < fileContent.length; i++){
                const char = fileContent[i]; 
                console.log("Playing note ", char);
                play(char); 
                // if wanted to pause between them:
                await new Promise(resolve => setTimeout(resolve, 250)); 
            }

            outputText.textContent = fileContent;
        }

        reader.readAsText(file); 
    }
</script>
</html>